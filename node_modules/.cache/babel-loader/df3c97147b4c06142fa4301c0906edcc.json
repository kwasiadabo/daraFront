{"ast":null,"code":"import _objectSpread from\"/Users/mac/Documents/Dara/daraPlusApp/daraFront/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/mac/Documents/Dara/daraPlusApp/daraFront/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/Documents/Dara/daraPlusApp/daraFront/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mac/Documents/Dara/daraPlusApp/daraFront/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import{useHistory}from'react-router-dom';import axios from'axios';import Joi from'joi-browser';import baseUrl from'../../../config.json';import{CButton,CCard,CCardBody,CCardFooter,CCol,CContainer,CForm,CInput,CInputGroup,CInputGroupPrepend,CInputGroupText,CRow,CSelect}from'@coreui/react';import CIcon from'@coreui/icons-react';import Swal from'sweetalert2';var Register=function Register(){var _useState=useState({staff:'',email:'',password:'',confirmPassword:''}),_useState2=_slicedToArray(_useState,2),userRegister=_useState2[0],setUserRegister=_useState2[1];var history=useHistory();var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),staff=_useState4[0],setStaff=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),search=_useState6[0],setSearch=_useState6[1];var dateOfAppointmentRef=useRef();var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),departments=_useState8[0],setDepartment=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),grade=_useState10[0],setGrade=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),unit=_useState12[0],setUnit=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),deptId=_useState14[0],setDeptId=_useState14[1];var _useState15=useState(new Date()),_useState16=_slicedToArray(_useState15,2),appDate=_useState16[0],setAppDate=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),password=_useState18[0],setPassword=_useState18[1];var joiUserSchema=Joi.object().keys({staffId:Joi.string().required().label('Staff ID'),email:Joi.string().email({minDomainSegments:2,tlds:{allow:['ugmc.ug.edu.gh']}}),password:Joi.string().required().label('Password'),confirmPassword:Joi.string().required().label('confirm Password')});var validateForm=function validateForm(){var result=Joi.validate(userRegister,joiUserSchema);if(result.error){return result.error.details[0].message;}else{genPassword();return null;}// console.log(result);\n};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var validate,results;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();console.log(userRegister);if(!(userRegister.password!==userRegister.confirmPassword)){_context.next=4;break;}return _context.abrupt(\"return\",Swal.fire('Password Confirmation','Password Confirmation Failed','info'));case 4:validate=validateForm();if(!(validate===null)){_context.next=26;break;}_context.next=8;return axios.get('https://ugmcservice.herokuapp.com/api/stafflist/'+userRegister.staffId.toUpperCase()+'/'+userRegister.email);case 8:results=_context.sent;if(!(results.data.length>0)){_context.next=23;break;}_context.prev=10;_context.next=13;return axios.post('https://ugmcservice.herokuapp.com/api/users',{staffId:userRegister.staffId.toUpperCase(),email:userRegister.email,fullName:results.data[0].fullName,password:userRegister.password,confirmPassword:userRegister.confirmPassword,grade:results.data[0].grade,isAdmin:false,isHeadOfUnit:false,isHeadOfDepartment:false,isSupervisor:false});case 13:setUserRegister({staffId:'',email:'',password:'',confirmPassword:''});Swal.fire('Success','Registration successful','success');return _context.abrupt(\"return\",history.replace('/'));case 18:_context.prev=18;_context.t0=_context[\"catch\"](10);return _context.abrupt(\"return\",Swal.fire('OOPS','Registration NOT successful. Account may already exists !','error'));case 21:_context.next=24;break;case 23:return _context.abrupt(\"return\",Swal.fire('OOPS','Staff details NOT found, Please check and try again or contact HR Department','error'));case 24:_context.next=27;break;case 26:return _context.abrupt(\"return\",Swal.fire('OOPS',validate,'info'));case 27:case\"end\":return _context.stop();}}},_callee,null,[[10,18]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();useEffect(function(){function getStaff(){return _getStaff.apply(this,arguments);}function _getStaff(){_getStaff=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var results;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get(baseUrl.apiUrl+'/setup/staff');case 2:results=_context2.sent;setStaff(results.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return _getStaff.apply(this,arguments);}getStaff();},[]);var handleAppDate=function handleAppDate(sdate){var dateSelected=new Date(sdate);setAppDate(dateSelected);setUserRegister(_objectSpread(_objectSpread({},userRegister),{},{dateOfAppointment:dateSelected}));};var data={grades:grade.filter(function(item){return item.grade.toLowerCase().includes(search.toLowerCase())||item.grade.includes(search.toLowerCase());})};var dataTouse=search.length===0?grade:data.grades;function genPassword(){var chars='123456789abcdefghijklmnpqrstuvwxyzABCDEFGHIJKLMNPQRSTUVWXYZ';var passwordLength=8;var tempPassword='';for(var i=0;i<=passwordLength;i++){var randomNumber=Math.floor(Math.random()*chars.length);tempPassword+=chars.substring(randomNumber,randomNumber+1);}setPassword(tempPassword);}return/*#__PURE__*/React.createElement(\"div\",{className:\"c-app c-default-layout flex-row align-items-center\"},/*#__PURE__*/React.createElement(CContainer,null,/*#__PURE__*/React.createElement(CRow,{className:\"justify-content-center\"},/*#__PURE__*/React.createElement(CCol,{md:\"9\",lg:\"7\",xl:\"6\"},/*#__PURE__*/React.createElement(CCard,{className:\"mx-4\"},/*#__PURE__*/React.createElement(CCardBody,{className:\"p-4\"},/*#__PURE__*/React.createElement(CForm,null,/*#__PURE__*/React.createElement(\"h1\",null,\"Register\"),/*#__PURE__*/React.createElement(\"p\",{className:\"text-muted\"},\"Create your account\"),/*#__PURE__*/React.createElement(CInputGroup,{className:\"mt-3\"},/*#__PURE__*/React.createElement(CInputGroupPrepend,null,/*#__PURE__*/React.createElement(CInputGroupText,null,/*#__PURE__*/React.createElement(CIcon,{name:\"cil-user\"}))),/*#__PURE__*/React.createElement(CSelect,{className:\"form-select col-sm-10\",\"aria-label\":\"Default select example\",value:userRegister.staff,onChange:function onChange(e){return setUserRegister(_objectSpread(_objectSpread({},userRegister),{},{staff:e.currentTarget.value}));}},/*#__PURE__*/React.createElement(\"option\",{value:\"\"},\"Staff *\"),staff.map(function(s){return/*#__PURE__*/React.createElement(\"option\",{key:s.id,value:s.id,id:s.id},s.nameOfStaff);}))),/*#__PURE__*/React.createElement(CInputGroup,{className:\"mb-3\"},/*#__PURE__*/React.createElement(CInputGroupPrepend,null,/*#__PURE__*/React.createElement(CInputGroupText,null,/*#__PURE__*/React.createElement(CIcon,{name:\"cil-user\"}))),/*#__PURE__*/React.createElement(CInput,{type:\"text\",placeholder:\"Staff ID\",autoComplete:\"staffid\",value:userRegister.staffId,onChange:function onChange(e){return setUserRegister(_objectSpread(_objectSpread({},userRegister),{},{staffId:e.currentTarget.value}));}})),/*#__PURE__*/React.createElement(CInputGroup,{className:\"mb-3\"},/*#__PURE__*/React.createElement(CInputGroupPrepend,null,/*#__PURE__*/React.createElement(CInputGroupText,null,\"@\")),/*#__PURE__*/React.createElement(CInput,{type:\"text\",placeholder:\"Email\",autoComplete:\"email\",value:userRegister.email,onChange:function onChange(e){return setUserRegister(_objectSpread(_objectSpread({},userRegister),{},{email:e.currentTarget.value}));}})),/*#__PURE__*/React.createElement(CInputGroup,{className:\"mb-3\"},/*#__PURE__*/React.createElement(CInputGroupPrepend,null,/*#__PURE__*/React.createElement(CInputGroupText,null,/*#__PURE__*/React.createElement(CIcon,{name:\"cil-lock-locked\"}))),/*#__PURE__*/React.createElement(CInput,{type:\"password\",placeholder:\"Password\",autoComplete:\"new-password\",value:userRegister.password,onChange:function onChange(e){return setUserRegister(_objectSpread(_objectSpread({},userRegister),{},{password:e.currentTarget.value}));}})),/*#__PURE__*/React.createElement(CInputGroup,{className:\"mb-4\"},/*#__PURE__*/React.createElement(CInputGroupPrepend,null,/*#__PURE__*/React.createElement(CInputGroupText,null,/*#__PURE__*/React.createElement(CIcon,{name:\"cil-lock-locked\"}))),/*#__PURE__*/React.createElement(CInput,{type:\"password\",placeholder:\"Repeat password\",autoComplete:\"new-password\",value:userRegister.confirmPassword,onChange:function onChange(e){return setUserRegister(_objectSpread(_objectSpread({},userRegister),{},{confirmPassword:e.currentTarget.value}));}})),/*#__PURE__*/React.createElement(CButton,{color:\"success\",block:true,onClick:handleSubmit},\"Create Account\"))),/*#__PURE__*/React.createElement(CCardFooter,{className:\"p-4\"},/*#__PURE__*/React.createElement(CRow,null)))))));};export default Register;","map":{"version":3,"sources":["/Users/mac/Documents/Dara/daraPlusApp/daraFront/src/views/pages/register/Register.js"],"names":["React","useState","useEffect","useRef","useHistory","axios","Joi","baseUrl","CButton","CCard","CCardBody","CCardFooter","CCol","CContainer","CForm","CInput","CInputGroup","CInputGroupPrepend","CInputGroupText","CRow","CSelect","CIcon","Swal","Register","staff","email","password","confirmPassword","userRegister","setUserRegister","history","setStaff","search","setSearch","dateOfAppointmentRef","departments","setDepartment","grade","setGrade","unit","setUnit","deptId","setDeptId","Date","appDate","setAppDate","setPassword","joiUserSchema","object","keys","staffId","string","required","label","minDomainSegments","tlds","allow","validateForm","result","validate","error","details","message","genPassword","handleSubmit","e","preventDefault","console","log","fire","get","toUpperCase","results","data","length","post","fullName","isAdmin","isHeadOfUnit","isHeadOfDepartment","isSupervisor","replace","getStaff","apiUrl","handleAppDate","sdate","dateSelected","dateOfAppointment","grades","filter","item","toLowerCase","includes","dataTouse","chars","passwordLength","tempPassword","i","randomNumber","Math","floor","random","substring","currentTarget","value","map","s","id","nameOfStaff"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport axios from 'axios'\nimport Joi from 'joi-browser'\nimport baseUrl from '../../../config.json'\n\nimport {\n  CButton,\n  CCard,\n  CCardBody,\n  CCardFooter,\n  CCol,\n  CContainer,\n  CForm,\n  CInput,\n  CInputGroup,\n  CInputGroupPrepend,\n  CInputGroupText,\n  CRow,\n  CSelect,\n} from '@coreui/react'\nimport CIcon from '@coreui/icons-react'\nimport Swal from 'sweetalert2'\n\nconst Register = () => {\n  const [userRegister, setUserRegister] = useState({\n    staff: '',\n    email: '',\n    password: '',\n    confirmPassword: '',\n  })\n  let history = useHistory()\n  const [staff, setStaff] = useState([])\n  const [search, setSearch] = useState('')\n  const dateOfAppointmentRef = useRef()\n  const [departments, setDepartment] = useState([])\n  const [grade, setGrade] = useState([])\n  const [unit, setUnit] = useState([])\n  const [deptId, setDeptId] = useState('')\n  const [appDate, setAppDate] = useState(new Date())\n  const [password, setPassword] = useState('')\n\n  const joiUserSchema = Joi.object().keys({\n    staffId: Joi.string().required().label('Staff ID'),\n    email: Joi.string().email({\n      minDomainSegments: 2,\n      tlds: { allow: ['ugmc.ug.edu.gh'] },\n    }),\n    password: Joi.string().required().label('Password'),\n    confirmPassword: Joi.string().required().label('confirm Password'),\n  })\n\n  const validateForm = () => {\n    const result = Joi.validate(userRegister, joiUserSchema)\n    if (result.error) {\n      return result.error.details[0].message\n    } else {\n      genPassword()\n      return null\n    }\n    // console.log(result);\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    console.log(userRegister)\n\n    if (userRegister.password !== userRegister.confirmPassword) {\n      return Swal.fire(\n        'Password Confirmation',\n        'Password Confirmation Failed',\n        'info',\n      )\n    }\n    const validate = validateForm()\n\n    if (validate === null) {\n      const results = await axios.get(\n        'https://ugmcservice.herokuapp.com/api/stafflist/' +\n          userRegister.staffId.toUpperCase() +\n          '/' +\n          userRegister.email,\n      )\n\n      if (results.data.length > 0) {\n        try {\n          await axios.post('https://ugmcservice.herokuapp.com/api/users', {\n            staffId: userRegister.staffId.toUpperCase(),\n            email: userRegister.email,\n            fullName: results.data[0].fullName,\n            password: userRegister.password,\n            confirmPassword: userRegister.confirmPassword,\n            grade: results.data[0].grade,\n            isAdmin: false,\n            isHeadOfUnit: false,\n            isHeadOfDepartment: false,\n            isSupervisor: false,\n          })\n          setUserRegister({\n            staffId: '',\n            email: '',\n            password: '',\n            confirmPassword: '',\n          })\n          Swal.fire('Success', 'Registration successful', 'success')\n          return history.replace('/')\n        } catch (ex) {\n          return Swal.fire(\n            'OOPS',\n            'Registration NOT successful. Account may already exists !',\n            'error',\n          )\n        }\n      } else {\n        return Swal.fire(\n          'OOPS',\n          'Staff details NOT found, Please check and try again or contact HR Department',\n          'error',\n        )\n      }\n    } else {\n      return Swal.fire('OOPS', validate, 'info')\n    }\n  }\n\n  useEffect(() => {\n    async function getStaff() {\n      const results = await axios.get(baseUrl.apiUrl + '/setup/staff')\n      setStaff(results.data)\n    }\n    getStaff()\n  }, [])\n\n  const handleAppDate = (sdate) => {\n    let dateSelected = new Date(sdate)\n    setAppDate(dateSelected)\n    setUserRegister({\n      ...userRegister,\n      dateOfAppointment: dateSelected,\n    })\n  }\n\n  const data = {\n    grades: grade.filter(\n      (item) =>\n        item.grade.toLowerCase().includes(search.toLowerCase()) ||\n        item.grade.includes(search.toLowerCase()),\n    ),\n  }\n\n  const dataTouse = search.length === 0 ? grade : data.grades\n\n  function genPassword() {\n    let chars = '123456789abcdefghijklmnpqrstuvwxyzABCDEFGHIJKLMNPQRSTUVWXYZ'\n    let passwordLength = 8\n    let tempPassword = ''\n    for (let i = 0; i <= passwordLength; i++) {\n      let randomNumber = Math.floor(Math.random() * chars.length)\n      tempPassword += chars.substring(randomNumber, randomNumber + 1)\n    }\n    setPassword(tempPassword)\n  }\n\n  return (\n    <div className=\"c-app c-default-layout flex-row align-items-center\">\n      <CContainer>\n        <CRow className=\"justify-content-center\">\n          <CCol md=\"9\" lg=\"7\" xl=\"6\">\n            <CCard className=\"mx-4\">\n              <CCardBody className=\"p-4\">\n                <CForm>\n                  <h1>Register</h1>\n                  <p className=\"text-muted\">Create your account</p>\n                  <CInputGroup className=\"mt-3\">\n                    <CInputGroupPrepend>\n                      <CInputGroupText>\n                        <CIcon name=\"cil-user\" />\n                      </CInputGroupText>\n                    </CInputGroupPrepend>\n                    <CSelect\n                      className=\"form-select col-sm-10\"\n                      aria-label=\"Default select example\"\n                      value={userRegister.staff}\n                      onChange={(e) =>\n                        setUserRegister({\n                          ...userRegister,\n                          staff: e.currentTarget.value,\n                        })\n                      }\n                    >\n                      <option value=\"\">Staff *</option>\n                      {staff.map((s) => (\n                        <option key={s.id} value={s.id} id={s.id}>\n                          {s.nameOfStaff}\n                        </option>\n                      ))}\n                    </CSelect>\n                  </CInputGroup>\n\n                  <CInputGroup className=\"mb-3\">\n                    <CInputGroupPrepend>\n                      <CInputGroupText>\n                        <CIcon name=\"cil-user\" />\n                      </CInputGroupText>\n                    </CInputGroupPrepend>\n                    <CInput\n                      type=\"text\"\n                      placeholder=\"Staff ID\"\n                      autoComplete=\"staffid\"\n                      value={userRegister.staffId}\n                      onChange={(e) =>\n                        setUserRegister({\n                          ...userRegister,\n                          staffId: e.currentTarget.value,\n                        })\n                      }\n                    />\n                  </CInputGroup>\n                  <CInputGroup className=\"mb-3\">\n                    <CInputGroupPrepend>\n                      <CInputGroupText>@</CInputGroupText>\n                    </CInputGroupPrepend>\n                    <CInput\n                      type=\"text\"\n                      placeholder=\"Email\"\n                      autoComplete=\"email\"\n                      value={userRegister.email}\n                      onChange={(e) =>\n                        setUserRegister({\n                          ...userRegister,\n                          email: e.currentTarget.value,\n                        })\n                      }\n                    />\n                  </CInputGroup>\n                  <CInputGroup className=\"mb-3\">\n                    <CInputGroupPrepend>\n                      <CInputGroupText>\n                        <CIcon name=\"cil-lock-locked\" />\n                      </CInputGroupText>\n                    </CInputGroupPrepend>\n                    <CInput\n                      type=\"password\"\n                      placeholder=\"Password\"\n                      autoComplete=\"new-password\"\n                      value={userRegister.password}\n                      onChange={(e) =>\n                        setUserRegister({\n                          ...userRegister,\n                          password: e.currentTarget.value,\n                        })\n                      }\n                    />\n                  </CInputGroup>\n                  <CInputGroup className=\"mb-4\">\n                    <CInputGroupPrepend>\n                      <CInputGroupText>\n                        <CIcon name=\"cil-lock-locked\" />\n                      </CInputGroupText>\n                    </CInputGroupPrepend>\n                    <CInput\n                      type=\"password\"\n                      placeholder=\"Repeat password\"\n                      autoComplete=\"new-password\"\n                      value={userRegister.confirmPassword}\n                      onChange={(e) =>\n                        setUserRegister({\n                          ...userRegister,\n                          confirmPassword: e.currentTarget.value,\n                        })\n                      }\n                    />\n                  </CInputGroup>\n                  <CButton color=\"success\" block onClick={handleSubmit}>\n                    Create Account\n                  </CButton>\n                </CForm>\n              </CCardBody>\n              <CCardFooter className=\"p-4\">\n                <CRow>\n                  {/*<CCol xs=\"12\" sm=\"6\">\n                    <CButton className=\"btn-facebook mb-1\" block><span>facebook</span></CButton>\n                  </CCol>\n                  <CCol xs=\"12\" sm=\"6\">\n                    <CButton className=\"btn-twitter mb-1\" block><span>twitter</span></CButton>\n  </CCol>*/}\n                </CRow>\n              </CCardFooter>\n            </CCard>\n          </CCol>\n        </CRow>\n      </CContainer>\n    </div>\n  )\n}\n\nexport default Register\n"]},"metadata":{},"sourceType":"module"}